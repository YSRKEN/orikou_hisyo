おりこうさんな秘書 Ver.1.5
※等幅フォントで表示することを推奨します
--------------------------------------------------------------------------------
[ソフト紹介]
　このソフトウェアは、艦これの画面を常に監視しつつ、要所要所でスクショを自動で
撮ってくれるソフトです。これにより、いつでも母港画面や編成画面や戦果報告などを
確認できるようになるので、例えば次のような用途に役立ちます。
　・戦果報告を適当にクリックで飛ばしたから大破してないかが分からない場合に、
　　遡って確認することが出来る。大破進軍、ダメ・ゼッタイ！
　・艦隊の編成や装備も確認できるので、進軍中でも遠征に出した編成をサッと見られる
　・名前隠し機能もあるので、スクショでうっかり提督名を晒してしまうこともない
　また特殊な機能として、次のような機能も実装しています。
　・改装画面でのスクショを利用した「装備まとめ画像作成機能」
　・母港・マップ・戦闘画面において「BGMを自動で流せる機能」
　・必要経験値や周回数を計算する「経験値計算機」
　・入渠画面を画像で読み取り、自動でカウントする「入渠タイマー」
　・艦これの画面がうっかりズレても大丈夫な「自動ズレ補正機能」

　なお、このソフトの仕組みとしては単に画像をスクショで読み取るだけのものです。
ゆえに、このソフトは「艦これ」開発/運営がおっしゃるところの「不正ツール」
ではないと考えております。

[インストール・アンインストール方法]
・インストール方法
　zipファイルを解凍するだけです。
・アンインストール方法
　ファイルをそのまま削除するだけです。レジストリは使用しません。

[ファイル]
☆orikou.exe……実行ファイル
☆hspcv.dll……動作に必要なライブラリ
☆cursor.png……カーソルアイコン画像(自作)
・Readme.txt……この文書のこと
・format.txt……セーブデータの書式
・sourceフォルダ
　・Manual.txt……ソースコードを読み解く際の手引き(必読)
　・orikou14.hsp……本体のソースコード。ここから実行して下さい
　・{その他}.hsp……ライブラリ等。コードを分割しています
　・area_exp.txt……マップ経験値一覧
　・exp_table.txt……レベル―経験値対応表
　・scene_list.txt……認識可能なシーン一覧
※ソフト自体の動作には、☆の付いたものだけで十分です
※セーブデータとして、orikou.exeと同フォルダに「save.txt」「save.png」が
　作成されます。なので、書き込みができないドライブ上では使用できません。

[操作方法]
1.　実行すると、次の2つのウィンドウが表示されます。
　　・縦長の小さなウィンドウ(メイン画面。常に最前面)
　　・横長のウィンドウ(サブ画面。常に最前面)
　　この際、セーブデータが存在していた場合はそちらを読み込むので、
　　多少起動に手間取るかもしれません。

2.　メイン画面の各ボタン・コンボボックス・チェックボックスについて説明します。
　　1行目……座標設定用の項目(3.〜4.で説明)
　　2〜4行目……表示画像設定用の項目(5.〜7.で説明)
　　5〜7行目……BGM設定用の項目(8.で説明)
　　8〜12行目……各種オプションおよび特殊機能用の項目(9.以降で説明)

3.　どのウィンドウも艦これの画面を隠さないようにしてから、まずは「座標取得」
　ボタンを押してください。すると、艦これの画面の位置が判定されます。
　　ここでFlashのサイズは、ブラウザの表示設定で「100％」表示にしてください。
　　判定方法は次の2つがあります。
　　"自動設定"……モニタ全体のスクショから検索
　　"手動設定"……手動で検索範囲を指定する。こちらの場合、モニタ全体をキャプチャ
　　　　　　　　　した上でマウスで選択させます。なお、Escキーで中断はEscキーです。
　　なお、マルチディスプレイの場合はどのディスプレイ上でも認識します。

4.　サブ画面のタイトルバーには、次の形式で情報が示されています。
　　　『ソフト名 - 表示モード - 認識結果 - (艦これの座標)』
　　・表示モード……メイン画面の表示モードを切り替えると変更されます。
　　・認識結果……現在の艦これFlashの状況を示すためのものです。
　　　　　　　　　表示モードに対応するものがない場合は全て「不明」と表示されます。
　　・艦これの座標……艦これの画面の左上のことを指します。
　　　　　　　　　　　初期値は(0,0)ですが、座標取得することで変更されます。

5.　認識結果が「不明」以外の場合、それぞれ最後に表示された内容が記録されます。
　　その内容は、2行目左の表示モードを切り替えることでサブ画面に表示されます。
　　・現在状況……その瞬間に、艦これの画面に表示されている場面
　　・母港画面……秘書艦と6つの大きな歯車が鎮座している場面
　　・工廠画面1……ドックが表示されている画面(通常時)
　　・工廠画面2……ドックが表示されている画面(建造・開発等の暗転時)
　　・入渠画面……入渠ドックの画面(通常時)
　　・戦績表示……提督経験値、最大保有可能数等が表示されている場面
　　・ランキング……提督経験値がランキングされている画面
　　・マップ画面……海域に出撃してからの道中(羅針盤部分)の場面
　　・昼戦画面……説明略
　　・夜戦画面……説明略
　　・交戦結果……戦闘終了直後の、敵味方の損害状況が表示された場面
　　・戦果報告……MVPが表示されている場面。大破チェック(後述)はこの際働く
　　・演習一覧……演習時に表示される5つの艦隊の場面
　　・演習個別‥…演習相手を選択した際の詳細表示場面
　　・中破画面……中破した際の画像
　　・大破画面……大破した際の画像
　　・編成画面、改装画面……第1〜第4艦隊まで対応

6.　サブ画面の表示は表示モードに従うので、例えば次の用途に使えます。
　　・進軍選択の際、うっかり戦果報告を見逃しても大破してないかを確認可能
　　・マップ画面も見返せるので、どのマスまで進軍したかも確認可能
　　・現在の艦隊の編成・装備をサーバーに負担を掛けずに確認できる

7.　「【画像保存】」ボタンと、「【○○艦隊】」ボタンは、どちらもexeと同じ
　フォルダに画像を保存する機能です。この際ファイル名は、現在日時＋連番で
　記憶されるので、連打しても上書きはされません。違いとしては次の通りです。
　　・【画像保存】
　　　　現在サブ画面に表示されている内容をそのまま保存します。名前隠し(後述)の
　　　状態も反映されますので、スレに貼る時などに有効でしょう。
　　・【○○艦隊】
　　　　このボタンの左にある内容(第1〜第4艦隊、連合艦隊、支援艦隊)に従い、
　　　編成まとめ画像(艦娘の状態と装備をまとめたもの)を自動作成して保存します。
　　　　要するに、改装画面からパラパラと各艦娘を確認してからこのボタンを押せば
　　　すぐにまとめ画像が作成できるわけです。

8.　母港(ここではマップ画面と戦闘画面以外という意味)とマップ画面と戦闘画面で
　好きなBGMを流せる機能が搭載されています。コンボボックスには、それぞれの
　場合について「シーン(再生ON/OFF,ファイル名)」が表示されています。
　　手順としては、あるシーンについてファイルを登録した後、当該シーンになれば
　自動で再生されます。なお、切り替えボタンで鳴らすか否かを切り替えできます。
　　「参照...」ボタンによって音楽ファイルを選択すると曲が更新されます。
　ちなみに読み込まれる音声ファイルはWAVとMP3とWMAのみとなります。
　　「強制停止」ボタンはBGMを強制的に止める機能で、「強制再生」ボタンは
　場面に合わせたBGMを強制的に鳴らす機能です。なるべくこの二つを押さなくて済む
　ように努力はしていますが、最終手段としてお使いください。

9.　「経験値計算」ボタンを押すと、経験値計算機の画面が現れます。
　　要するにレベル・海域・勝利状況・オプションを設定すれば自動的に
　　必要な周回数などを計算してくれる、といったものです。
　　もちろん、「閉じる」ボタンを押せば画面は閉じられます。

10.　「入渠タイマー」ボタンを押すと、入渠タイマーの画面が現れます。
　　艦これの画面で入渠画面を表示させた状態で「更新」ボタンを押すと、
　　入渠画面から残り時間を自動で読み取った上で、残り時間と終了予定時刻を
　　表示してくれます。勿論、一度更新すると、艦これの画面を入渠画面から
　　切り替えてもカウントは続行されます。

11.　「○号カウンター」ボタンを押すと、あ号・い号・ろ号作戦用のカウンターが
　　現れます。使い方は見たまんまです。各号毎にリセットできるようにしました。

12.　以下、他のチェックボックス等について説明します。
　　・名前隠し
　　　母港・戦績・戦果等の場面で提督名を隠す機能です。
　　・カーソル
　　　　サブ画面にマウスカーソルを表示できます(画像保存時は写りません)。
　　　　表示画像はcursor.pngを差し替えれば何でも表示できますが、その際は
　　　(255,0,0)が透明色なのでご注意下さい。なお、このカーソルは前述の
　　　「【画像保存】」ボタンで保存されます……が、まず写りませんよね？
　　・大破チェック
　　　　表示モードが現在画面で、かつ戦果報告の際に大破艦が存在していた場合、
　　　ダイアログで警告メッセージが表示されます。大破進撃は「ダメ・ゼッタイ」！
　　　　ちなみにこのダイアログは、艦これが戦果報告の画面である限り何度でも
　　　出続けますので、消したい人はチェックを外すか進撃選択画面に移動して下さい。
　　・ズレ補正
　　　　「艦これの画面の周りが均一な同色背景である」
　　　　(普通のブラウザならそうなっているはず)前提を元に、取得座標からのズレを
　　　　認識し、自動で座標を取得しなおす機能です。当然再取得は重くなるので、
　　　　ズレチェックは1秒毎に実行しています。
　　・画面クロップ
　　　　通常、「【画像保存】」ボタンを押すと、800x480のスクショが保存されます。
　　　　しかしこれにチェックが入っていると、編成画面では編成部分のみ、
　　　　改装画面では艦娘画面のみのスクショが保存されます。まずは一度お試しを。
　　・倍率〜％
　　　　サブ画面のサイズを変更できる機能です。50・75・100・150・200％表示に
　　　することができます。なお、画像保存時は800x480固定なので注意！
　　・〜fps
　　　　画像を取得する更新頻度を変更できます。デフォルトでは30fpsですが、
　　　下げることで負荷を軽減できます。なお、1〜30fpsまで対応しています。

13.　「情報」ボタンを押すと、バージョン情報が表示されます。

14.　このソフトの設定、およびバッファ内の画像はソフト終了時に自動でセーブされます。
　　また、突然のシステムエラーに備えて、手動で保存することも可能です。
　　これらのデータは、ソフト起動時には自動的に読み込まれます。

[内部処理の説明]
　アルゴリズムとしては、WinAPIでスクショ撮影→画像認識でシーン判断→
用意したバッファに自動保存、となります。画像認識とは言っても、相当簡略化してる
ので認識に失敗することもあるかもしれません。艦これのswfを解析して認識用データに
使用してる、なんてことは一切ありませんのでご心配なく。
　それと、入渠タイマーでの画像認識は全て自前で行っています。
　なお、ブラウザが100％表示の時以外に使えないのも認識アルゴリズムの仕様です。

[注意]
・原理がスクショ＋画像認識ですので、コマンドを送りつけるマクロ・BOTや、
　プロキシで通信を拾う専ブラとは別物です！

・バグでスクショが上手く記録されてなかったりとかする可能性もありますので、
　その辺は自己責任でご使用ください。

・上にも書きましたが、100％表示(800x480の画面)だけを認識するので、ブラウザ側で
　下手に拡大縮小すると艦これの画面だと認識されません。

・画像保存機能を使う都合上、ソフトウェア自体の権限に注意しましょう。最近はUACや
　Windows SmartScreenなどが標準で動いている上、セキュリティソフトが自動で監視
　している場合がありますので、警告ダイアログに阻まれたりすることがあります……。

・自動更新する間隔を下げると、当然負荷は下がりますが、決定的瞬間を取り逃す
　リスクも増えるかもしれません(特に「中大破画像」などは)。もっとも、
　10fps程度まで下げてもまず取り逃がさないかと思われますが。

・装備まとめ画像作成機能にて、編成画面で途中の艦娘を外した場合、
　その反映方法が雑です。例えば、旗艦から睦月如月弥生卯月皐月文月と編成して、
　改装画面で6隻分切り替えておいたとします。ここでまとめ画像ボタンを押すと
　当然6隻分保存されますが、睦月〜皐月を外した場合も文月を外した場合も
　「5隻の艦隊」として扱われるため、末尾にいる文月の部分がクリアされます。
　要するに、ゴチャゴチャ入れ替えた後はもう一度改装画面に戻ってねということです。

・自動ズレ補正機能においてズレを検出した場合、「座標取得」ボタンを押すのと
　まったく同じルーチンでズレを補正します。つまり、手動設定にしていると
　ズレを検出するたびに毎回マウス選択を迫られることに……。また、アルゴリズムの
　都合上、ズレを100％検知できるわけではありませんので悪しからず。

・おりこうさん本体のソースコードは「Hot Soup Processor」という言語で記述されています。

[謝辞]
「艦これ一覧めいかー」
　(kanahiron氏、http://www.vector.co.jp/soft/winnt/game/se508332.html)
「赤城さんのお風呂タイマー」
　(Satofumi Kamimura氏、https://sites.google.com/site/bathtimer/)
「HSP-NEXT」
　(sakura氏、http://hspnext.com/index.html)
「Advanced HSP」
　(ちょくと氏、http://chokuto.ifdef.jp/advanced/index.html)
「Let's HSP!」
　(Kpan氏、http://lhsp.s206.xrea.com/)
「プログラミング工房」
　(chrono氏、http://lldev.jp/index.html)
この方々がいなければこのソフトウェアは生まれませんでした。深く感謝いたします。

[更新履歴]
＜Ver.1.5(2015/04/21)＞
・手動セーブ機能＆終了時セーブ機能を実装。
　これにより、終了して起動しなおしても設定とスクショが残せるようになった。
・マルチモニタに正式対応。どのディスプレイにあっても認識できるようになった。
・編成まとめ画像作成時に、以前の編成時の艦娘データが残ってしまう不具合を修正。
　これにより、5隻以下の編成を記録する際にいつでも正しく記録できるようになる。
・自動ズレ補正機能を実装。これにより、画面がズレても自動で戻せるようになった。
・ソースコードを読み解くためのマニュアルを付属させた。

＜Ver.1.4(2015/04/19)＞
・コードを分割して分かりやすくした。と言うか全面的に書き直した。
・サブ画面も最前面表示にした。また、デフォルトでは50％表示にした。
・保存可能なシーンを大幅に拡充した。それに伴い、
　演習個別でボタンを選択していると認識されない不具合を修正した。
・画面クロップ機能を搭載。これにより、編成画面で編成のみ、
　改装画面で艦娘のみを保存できるようにした。
・○号カウンターを各任務毎にリセットできるようにした。
・入渠タイマーが「現在入渠画面が表示されている時」じゃないと更新できない
　ようにした。誤作動防止のためなのでご理解ください。
・Tesseract-OCRの利用を辞めた。と言うかHSPでパイプ実行すると
　安定しなさすぎるんだよ！　なんでしょっちゅうフリーズしやがるのか……？
　(Tesseract-OCRが悪いとは言ってない。ほぼ間違いなくHSP側が悪いかと)

＜Ver.1.3(2015/02/23)＞
・サブ画面のマウスカーソル表示を、現在状況モードのみに限定した。
・サブ画面に表示されてるのが入渠画面でない時に入渠タイマーが使えないのを修正した。
・○○艦隊保存機能でのファイルパスがおかしかったのを修正した。
・演習一覧・演習個別の記録に対応した。
・Tesseract-OCRを利用して文字認識の精度を上げた。
・上記の機能を追加するために、ボタン等を少しだけ小さくした。

＜Ver.1.2(2015/02/19)＞
・サブ画面の更新頻度を1〜30fpsまで調整できるようにした。
・サブ画面にマウスカーソルを表示させられるようにするオプションを付けた。

＜Ver1.1(2015/02/18)＞
・【画像保存】ボタンで、保存される画像のサイズが「倍率〜〜％」に影響されない
　ようにした。これにより、文字が潰れずに安心して保存できるようになった。
・「倍率〜〜％」に拡大の方も実装した。大きなディスプレイでもこれで安心？
・中破・大破した際の画像も自動記録できるようにした。
・経験値計算機と入渠タイマーを追加実装した。

・Ver1.0(2015/02/15)
　初版。

[著作権]
【  ソフト名  】おりこうさんな秘書 Ver.1.5
【    種別    】フリーウェア
【    種類    】ユーティリティ
【   開発者   】YSR
【  動作環境  】Microsoft Windows 98,Me,2000,XP(NT4.0以降を含む),Vista,7,8,8.1
【  開発言語  】Hot Soup Processor ver.3.4beta
【   連絡先   】ysr.ken@gmail.com
【  Webページ 】http://www.vector.co.jp/vpack/browse/person/an050622.html
【    転載    】自由です。ただし、私の名前も一緒に乗せてください。
　このソフトに対する意見や感想、バグ報告等がありましたら、こちらに連絡してくださ
い。より良いソフトウェア作りに役立てたいと思います。

[コメント]
　少し前に大和を建造し、現在Lv80近く。春イベでも活躍してほしいものです。
